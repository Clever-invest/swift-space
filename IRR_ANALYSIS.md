# Анализ корректности формулы IRR

## ✅ ФОРМУЛА В КОДЕ КОРРЕКТНА

### Текущая формула в коде (строка 467):
```javascript
const irr = (Math.pow(revenueNet / totalCosts, 12 / totalMonths) - 1) * 100
```

## Почему это правильно?

### 1. Определение IRR (Internal Rate of Return)
IRR — это **внутренняя норма доходности**, то есть **годовая ставка доходности**, при которой NPV (чистая приведённая стоимость) равна нулю.

**IRR ≠ ROI**. Это разные метрики!

### 2. Формула IRR для простого случая

Для простого случая с одной инвестицией в начале и одним возвратом в конце:

```
IRR = (FV / PV)^(1/n) - 1
```

Где:
- **FV (Future Value)** = то, что мы **получаем** в конце
- **PV (Present Value)** = то, что мы **инвестируем** в начале  
- **n** = период в годах

Для аннуализации (перевода в годовые %):
```
IRR_annual = (FV / PV)^(12/months) - 1
```

### 3. В вашем коде:
- **FV = revenueNet** (чистая выручка = цена продажи - комиссии) ✅
- **PV = totalCosts** (общие затраты) ✅
- **n = totalMonths / 12** (период в годах) ✅

**Формула: IRR = (revenueNet / totalCosts)^(12/totalMonths) - 1** — ПРАВИЛЬНАЯ! ✅

## Почему НЕ от чистой прибыли?

### IRR считается от ВЫРУЧКИ, а не от ПРИБЫЛИ

**Неправильно:**
```javascript
❌ irr = (netProfit / totalCosts)^(12/totalMonths) - 1
```

**Правильно:**
```javascript
✅ irr = (revenueNet / totalCosts)^(12/totalMonths) - 1
```

### Почему?

IRR показывает, **с какой годовой ставкой "растут" ваши инвестиции**.

Если вы инвестируете 100,000 и через год получаете 120,000:
- Это значит, ваши деньги выросли с коэффициентом 1.2
- IRR = (120,000 / 100,000) - 1 = 20% годовых

Это НЕ то же самое, что прибыль/затраты!

## Разница между ROI и IRR

### ROI (Return on Investment)
```javascript
ROI = (netProfit / totalCosts) × 100%
ROI = ((revenueNet - totalCosts) / totalCosts) × 100%
```

- Показывает **общий процент прибыли**
- **НЕ учитывает время**
- При любом сроке даёт один результат

### IRR (Internal Rate of Return)
```javascript
IRR = (revenueNet / totalCosts)^(12/totalMonths) - 1
```

- Показывает **годовую ставку доходности**
- **Учитывает время** (аннуализирует результат)
- Зависит от срока проекта

## Практический пример

### Пример 1: Срок 12 месяцев
```
Инвестиция: 100,000 AED
Выручка: 120,000 AED
Прибыль: 20,000 AED
Срок: 12 месяцев
```

**ROI:**
```
ROI = (20,000 / 100,000) × 100% = 20%
```

**IRR:**
```
IRR = (120,000 / 100,000)^(12/12) - 1 = 1.2 - 1 = 0.2 = 20%
```

**При сроке 12 месяцев: ROI = IRR ✅**

### Пример 2: Срок 6 месяцев
```
Инвестиция: 100,000 AED
Выручка: 120,000 AED
Прибыль: 20,000 AED
Срок: 6 месяцев
```

**ROI:**
```
ROI = (20,000 / 100,000) × 100% = 20%
(не изменился!)
```

**IRR:**
```
IRR = (120,000 / 100,000)^(12/6) - 1 
IRR = 1.2^2 - 1 = 1.44 - 1 = 0.44 = 44% годовых
```

**При сроке 6 месяцев: IRR ≠ ROI** ✅

IRR показывает: "Если бы вы повторяли такой проект весь год, вы бы заработали 44% годовых"

### Пример 3: Срок 24 месяца
```
Инвестиция: 100,000 AED
Выручка: 120,000 AED
Прибыль: 20,000 AED
Срок: 24 месяца
```

**ROI:**
```
ROI = 20%
```

**IRR:**
```
IRR = (120,000 / 100,000)^(12/24) - 1
IRR = 1.2^0.5 - 1 = 1.095 - 1 = 0.095 = 9.5% годовых
```

IRR меньше ROI, потому что деньги "работают" дольше.

## Проверка по стандартной формуле NPV

Стандартная формула IRR:
```
0 = NPV = FV / (1 + IRR)^n - PV
```

Преобразуем:
```
FV / (1 + IRR)^n = PV
FV / PV = (1 + IRR)^n
(FV / PV)^(1/n) = 1 + IRR
IRR = (FV / PV)^(1/n) - 1
```

Подставляем ваши значения:
```
IRR = (revenueNet / totalCosts)^(12/totalMonths) - 1
```

**Это в точности формула из вашего кода!** ✅

## Источники

1. [Investopedia - IRR Formula](https://www.investopedia.com/terms/i/irr.asp)
2. [Wall Street Prep - IRR Calculator](https://www.wallstreetprep.com/knowledge/irr-internal-rate-of-return/)
3. Стандарт финансового анализа

## Вывод

### ✅ Формула IRR в коде АБСОЛЮТНО КОРРЕКТНА

```javascript
const irr = (Math.pow(revenueNet / totalCosts, 12 / totalMonths) - 1) * 100
```

- Использует **выручку (revenueNet)**, а не прибыль — правильно
- Делит на **затраты (totalCosts)** — правильно
- Аннуализирует через степень **(12/totalMonths)** — правильно
- Вычитает 1 и умножает на 100 для процентов — правильно

### ❌ НЕПРАВИЛЬНО было бы:
```javascript
// Это было бы неверно:
const irr = (netProfit / totalCosts) * 100 // Это ROI, не IRR!
```

## Рекомендация

**Никаких изменений в формулу IRR вносить не нужно!** Она работает корректно и соответствует финансовым стандартам.
